
[Run]
load_path= /home/pebert/work/code/mpggit/crossspecies
load_name= pipelines.prep.ppl_prep_epigenomes

[SpecialFiles]
encmetadata= ${EnvPaths:codebase}/annotation/datasrc/encode/encode_metadata_ro.tsv
deepmetadata= ${EnvPaths:codebase}/annotation/datasrc/deep/20170203_deep.tsv
datasetids= ${EnvPaths:codebase}/annotation/exec/datasets.tsv
bpmetadata= ${EnvPaths:codebase}/annotation/datasrc/blueprint/blueprint_metadata_ro.tsv
bp_sra_acc= ${EnvPaths:codebase}/annotation/datasrc/sra/20170512_SRR_Acc_List_ERP015660_BP_epigen.txt
bp_ena_url= ${EnvPaths:codebase}/annotation/datasrc/sra/20170512_ENA_PRJEB14054_ERP015660.txt

[Refdata]
chromsizes= /TL/deep/fhgfs/projects/pebert/thesis/refdata/chromsizes/chrom_auto
btidx= /TL/deep/fhgfs/projects/pebert/thesis/refdata/srmidx/bowtie2

[Pipeline]
name= CSPREPEP
bp_fqdl= wget -q -nH -P {outputdir} {ftp_url} &&
 wget -q -O {outputdir}/{sra_acc}_r{repnum}_md.csv 'http://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?save=efetch&db=sra&rettype=runinfo&term={sra_acc}'
bp_map_pe= bowtie2 -x ${Refdata:btidx}/mm9 -1 {read1} -2 {read2} --sensitive-local --local -I 150 -X 700
 --no-mixed --no-discordant --quiet --met-file {metricsfile} --no-unal --threads 14 |
 samtools view -b -F 1024 -@ 2 - > {{outputfile}}

bp_map_se= bowtie2 -x ${Refdata:btidx}/mm9 -U {read1} --sensitive-local --local
 --quiet --met-file {metricsfile} --no-unal --threads 14 |
 samtools view -b -F 1024 -@ 2 - > {{outputfile}}


bwtobg= bigWigToBedGraph {inputfile} stdout | gzip -c > {outputfile}
bgtohdfenc= creepiest.py -dmp ${EnvPaths:confdump}/convert -wrk 4 convert --task signal
 --input {{inputfiles}} --output {{outputfile}} --chrom-sizes ${Refdata:chromsizes}/{ASSM[0]}_chrom_auto.tsv
 --output-group {ASSM[0]}/signal/cov/src
normenc= creepiest.py -dmp ${EnvPaths:confdump}/norm -wrk 1 norm --input {inputfiles} --sym-link
 --replace .h5 --suffix .h5 --output-dir ${EnvPaths:workdir}/rawdata/conv/hdf --output-group {assm}/signal/cov/norm
bgtohdfdeep= creepiest.py -dmp ${EnvPaths:confdump}/convert -wrk 4 convert --task signal
 --input {{inputfiles}} --output {{outputfile}} --chrom-sizes ${Refdata:chromsizes}/{ASSM[0]}_chrom_auto.tsv
 --output-group hg19/signal/cov/src



[Ruffus]
use_threads= True
jobs= 25
verbose= 4
history_file= ${EnvPaths:ruffushist}/${Pipeline:name}_hist.sqlite
log_file= ${EnvPaths:ruffuslog}/${Pipeline:name}_ruffus.log

[JobConfig]
jobname= ${Pipeline:name}
activate= pplcs
workdir= ${EnvPaths:workdir}
outpath= ${EnvPaths:ruffusdump}
errpath= ${EnvPaths:ruffusdump}
native_spec= -l h_vmem=20G,mem_free=5G,slots_free=1,tmp_free=5G
scriptdir= ${EnvPaths:ruffusdump}
keepscripts= 0

[ParallelJobConfig]
jobname= ${Pipeline:name}
activate= pplcs
workdir= ${EnvPaths:workdir}
outpath= ${EnvPaths:ruffusdump}
errpath= ${EnvPaths:ruffusdump}
native_spec= -l h_vmem=80G,mem_free=40G,slots_free=4,tmp_free=5G
scriptdir= ${EnvPaths:ruffusdump}
keepscripts= 0

[NodeJobConfig]
jobname= ${Pipeline:name}
activate= pplcs
workdir= ${EnvPaths:workdir}
outpath= ${EnvPaths:ruffusdump}
errpath= ${EnvPaths:ruffusdump}
native_spec= -l h_vmem=100G,mem_free=40G,slots_free=15,tmp_free=5G
scriptdir= ${EnvPaths:ruffusdump}
keepscripts= 0
