[Run]
load_path= /home/pebert/work/code/mpggit/crossspecies
load_name= pipelines.prep.ppl_prep_transcriptomes

[SpecialFiles]
encmetadata= ${EnvPaths:codebase}/annotation/datasrc/encode/encode_metadata_ro.tsv
deepmetadata= ${EnvPaths:codebase}/annotation/datasrc/deep/20170516_deep.tsv
#srametadata= ${EnvPaths:codebase}/annotation/datasrc/sra/20160706_SRA_expression_fastq.tsv
#srametadata= ${EnvPaths:codebase}/annotation/datasrc/sra/20170328_SRA_expression_fastq.tsv
srametadata= ${EnvPaths:codebase}/annotation/datasrc/sra/20170516_SRA_expression_fastq.tsv
datasetids= ${EnvPaths:codebase}/annotation/exec/datasets.tsv

[Scripts]
mktrans= /home/pebert/work/code/mpggit/creepiest/scripts/preprocess/make_transcriptome.py
mrgens= /home/pebert/work/code/mpggit/creepiest/scripts/preprocess/merge_ucsc_ensembl.py

[Pipeline]
name= CSPREPTR

refdatabase= /TL/deep/fhgfs/projects/pebert/thesis/refdata
idxrefdir= ${refdatabase}/transcriptome/qindex
pcgenes= ${refdatabase}/genemodel/subsets/protein_coding

datadir= /TL/deep/fhgfs/projects/pebert/thesis/biodata/dlfolder
refdir= /TL/deep/fhgfs/projects/pebert/thesis/refdata/genemodel
sizedir= /TL/deep/fhgfs/projects/pebert/thesis/refdata/chromsizes
seqdir= /TL/deep/fhgfs/projects/pebert/thesis/refdata/genomes
orthdir= /TL/deep/fhgfs/projects/pebert/thesis/refdata/orthologs
tempdir= /TL/deep/fhgfs/projects/pebert/thesis/biodata/pipelined/conversion/encexp
tmpquant= /TL/deep/fhgfs/projects/pebert/thesis/biodata/pipelined/conversion/encexp/tmp
bedout= /TL/deep/fhgfs/projects/pebert/thesis/biodata/pipelined/conversion/encexp/bed
hdfout= /TL/deep/fhgfs/projects/pebert/thesis/biodata/pipelined/conversion/encexp/hdf5

encmd= /home/pebert/work/code/mpggit/creepiest/datasrc/encode/encode_metadata_ro.tsv
sramd= /home/pebert/work/code/mpggit/creepiest/datasrc/sra/20160706_SRA_expression_fastq.tsv

# dump sra to fastq
sradump= fastq-dump --dumpbase --split-files --skip-technical --readids --gzip
 --outdir ${EnvPaths:workdir}/rawdata/temp {{inputfile}}
# check quality and try to detect adapters...
fastqc_raw= fastqc --quiet --outdir {subpath[0][1]}/reports/raw --threads 6 {{inputfile}}
# default run of trim galore to filter out low quality reads
trim= trim_galore --length {minlength} --output_dir {outdir} --suppress_warn --paired {inputfiles}
# quantify on transcript/gene level
qallpe= salmon quant --index {index} --threads 15 --libType ISF -1 <(gunzip -c {reads1}) -2 <(gunzip -c {reads2})
 -o {outpath} --forgettingFactor 0.8 --useVBOpt --geneMap ${pcgenes}/{genemap} --seqBias --gcBias --dumpEq --quiet
hdfagg= agg_expression.py --input {{inputfiles}} --agg-output {{outputfile}} --split-output {subpath[0][3]}/conv/bed
 --model-dir ${pcgenes} --model-assembly {ASSM[0]}

; the following two tasks are outdated (kept for reference); both replaced with new ortho_multi_pred

;hcop_orth= ortho_pred.py --assembly-a hg19 --assembly-b mm9 --exptab-a {path[0]}/hg19_agg_exp.genes.h5
; --exptab-b {path[0]}/mm9_agg_exp.genes.h5 --orthologs ${refdatabase}/orthologs/hdf/hg19_mm9_hcop_orthologs.h5
; --hdf-out {{outputfile}}
; --json-out ${EnvPaths:workdir}/processing/norm/task_ortho_pred/hg19_mm9_hcop_ortho-pred.json
;
;orthodb_orth= ortho_multi_pred.py --exp-files {inputfiles}
; --ortho-file ${refdatabase}/orthologs/hdf/orthoDB_2015-v9_5vert.h5
; --output {outputfile}

odb_pred= ortho_multi_pred.py --exp-files {inputfiles} --output {outputfile}
          --ortho-file ${orthdir}/hdf/odb9_6species.h5

hcop_pred= ortho_multi_pred.py --exp-files {inputfiles} --output {outputfile}
           --ortho-file ${orthdir}/hdf/hcop_6species.h5

hdfconv= creepiest.py -nod -wrk 1 convert --task region -i {inputfile}
 -o {outputfile} --name-idx 3 --use-header


[Ruffus]
use_threads= True
jobs= 30
verbose= 2
history_file= ${EnvPaths:ruffushist}/${Pipeline:name}_hist.sqlite
log_file= ${EnvPaths:ruffuslog}/${Pipeline:name}_ruffus.log

[JobConfig]
jobname= ${Pipeline:name}
workdir= ${EnvPaths:workdir}
outpath= ${EnvPaths:ruffusdump}
errpath= ${EnvPaths:ruffusdump}
native_spec= -l h_vmem=10G,mem_free=5G,slots_free=1,tmp_free=5G
scriptdir= ${EnvPaths:ruffusdump}
keepscripts= 0

[MemJobConfig]
jobname= ${Pipeline:name}
workdir= ${EnvPaths:workdir}
outpath= ${EnvPaths:ruffusdump}
errpath= ${EnvPaths:ruffusdump}
native_spec= -l h_vmem=35G,mem_free=30G,slots_free=6,tmp_free=5G
scriptdir= ${EnvPaths:ruffusdump}
keepscripts= 0

[ParallelJobConfig]
jobname= ${Pipeline:name}
workdir= ${EnvPaths:workdir}
outpath= ${EnvPaths:ruffusdump}
errpath= ${EnvPaths:ruffusdump}
native_spec= -l h_vmem=30G,mem_free=20G,slots_free=15,tmp_free=5G
scriptdir= ${EnvPaths:ruffusdump}
keepscripts= 0
